{"version":3,"names":["goDropdownCss","GoDropdownStyle0","GoDropdown","open","this","disabled","originEl","document","activeElement","isActive","opened","emit","close","focusBackToTrigger","closed","focus","toggle","componentWillLoad","el","id","uniqueId","triggerEl","querySelector","triggerSelector","componentDidLoad","init","escapeHandler","e","code","focusOutHandler","contains","relatedTarget","addEventListener","disconnectedCallback","removeEventListener","clickOutsideCleanUp","cleanupAutoUpdate","setAttribute","setTriggerExpanded","noTriggerClickHandler","onClickOutside","target","middleware","offset","flip","autoUpdate","debounce","computePosition","strategy","placement","then","x","y","middlewareData","Object","assign","style","left","top","_b","_a","overflows","length","classList","add","remove","expanded","String","handleActiveChange","display","once","render","width","fullWidth","h","Host","key","class"],"sources":["src/components/go-dropdown/go-dropdown.scss?tag=go-dropdown","src/components/go-dropdown/go-dropdown.tsx"],"sourcesContent":["go-dropdown {\n  /**\n    @prop --dropdown-shadow:\n      Box shadow of dropdown\n      - default: var(--shadow-3)\n  */\n  --dropdown-shadow: var(--shadow-3);\n  /**\n    @prop --dropdown-bg-color:\n      Dropdown background color\n      - default: var(--go-color-lightest)\n  */\n  --dropdown-bg-color: var(--go-color-lightest);\n\n  /**\n    @prop --dropdown-duration:\n      Duration for dropdown open/close transition\n      - default: var(--go-duration-fast)\n  */\n  --dropdown-duration: var(--go-duration-fast);\n\n  /**\n    @prop --dropdown-radius:\n      Border radius of dropdown\n      - default: var(--radius-2)\n  */\n  --dropdown-radius: var(--radius-2);\n\n  position: fixed;\n  display: none;\n  visibility: hidden;\n  opacity: 0;\n  box-shadow: var(--dropdown-shadow);\n  pointer-events: none;\n  z-index: 1;\n  transform: translateY(-5px);\n  transform-origin: top;\n  width: var(--dropdown-width, 200px);\n  background-color: var(--dropdown-bg-color);\n  border-radius: var(--dropdown-radius);\n  @include transition(opacity var(--dropdown-duration), visibility, transform var(--dropdown-duration));\n  &.full-width {\n    --dropdown-width: 100%;\n  }\n  &.flip {\n    transform-origin: bottom;\n    transform: translateY(5px);\n  }\n\n  &.is-active {\n    visibility: visible;\n    opacity: 1;\n    pointer-events: inherit;\n    transform: translateY(0);\n  }\n}\n","import { Component, Host, h, Element, Prop, Method, Watch, Event, EventEmitter } from '@stencil/core';\nimport { uniqueId, debounce } from 'lodash-es';\nimport { computePosition, offset, flip, autoUpdate } from '@floating-ui/dom';\nimport { onClickOutside } from '../../utils';\n\n@Component({\n  tag: 'go-dropdown',\n  styleUrl: 'go-dropdown.scss',\n  shadow: false,\n})\nexport class GoDropdown {\n  @Element() el: HTMLElement;\n  /**\n   * Query selector string for the trigger element.\n   */\n  @Prop() triggerSelector: string;\n\n  /**\n   * keep track of active state\n   */\n  @Prop({ reflect: true, mutable: true }) isActive: boolean = false;\n\n  /**\n   * Width of the dropdown, any CSS width values can be used.\n   */\n  @Prop() width? = 'auto';\n\n  /**\n   * If set, trigger click event will need to be handled manually.\n   */\n  @Prop() noTriggerClickHandler = false;\n\n  /**\n   * If set, dropdown will take full width of its parent.\n   */\n  @Prop() fullWidth? = false;\n\n  /**\n   * if set, dropdown cannot be opened\n   */\n  @Prop() disabled? = false;\n\n  /**\n   * Emitted when dropdown is opened\n   */\n  @Event() opened: EventEmitter<void>;\n\n  // keep track of where the focus was before the dropdown opens\n  originEl: HTMLElement;\n\n  /**\n   * opens dropdown\n   */\n  @Method()\n  async open() {\n    if (this.disabled) {\n      return;\n    }\n    this.originEl = document.activeElement as HTMLElement;\n    this.isActive = true;\n    this.opened.emit();\n  }\n  /**\n   * Emitted when dropdown is opened\n   */\n  @Event() closed: EventEmitter<void>;\n\n  /**\n   * closes dropdown\n   */\n  @Method()\n  async close(focusBackToTrigger = false) {\n    this.isActive = false;\n    this.closed.emit();\n    if (this.originEl && focusBackToTrigger) {\n      this.originEl.focus();\n    }\n  }\n\n  /**\n   * toggles dropdown\n   */\n  @Method()\n  async toggle() {\n    if (this.isActive) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  private triggerEl: HTMLElement;\n\n  // reference to clean up function to autoupdate\n  // see https://floating-ui.com/docs/autoupdate\n  private cleanupAutoUpdate: () => void;\n\n  componentWillLoad() {\n    // if id attribute is not provided, generate a unique id for the dropdown\n    if (!this.el.id) {\n      this.el.id = uniqueId('go-dropdown-');\n    }\n    this.triggerEl = document.querySelector(`${this.triggerSelector}`) as HTMLElement;\n  }\n\n  private escapeHandler;\n  private focusOutHandler;\n  private clickOutsideCleanUp;\n\n  async componentDidLoad() {\n    if (!this.triggerEl) {\n      return;\n    }\n    await this.init();\n\n    // press esc to close dropdown\n    this.escapeHandler = (e) => {\n      if (e.code === 'Escape') {\n        this.close();\n      }\n    };\n    this.focusOutHandler = (e: FocusEvent) => {\n      if (this.triggerEl.contains(e.relatedTarget as Node)) {\n        return;\n      }\n      if (e.relatedTarget && !this.el.contains(e.relatedTarget as Node)) {\n        this.close();\n      }\n    };\n    document.addEventListener('keydown', this.escapeHandler);\n    // focus outside to close dropdown\n    this.el.addEventListener('focusout', this.focusOutHandler);\n  }\n\n  disconnectedCallback() {\n    if (this.escapeHandler) {\n      document.removeEventListener('keydown', this.escapeHandler);\n    }\n    if (this.focusOutHandler) {\n      this.el.removeEventListener('focusout', this.focusOutHandler);\n    }\n    if (this.clickOutsideCleanUp) {\n      this.clickOutsideCleanUp();\n    }\n    if (this.cleanupAutoUpdate) {\n      this.cleanupAutoUpdate();\n    }\n  }\n\n  @Method()\n  async init() {\n    this.triggerEl.setAttribute('aria-haspopup', 'true');\n    this.setTriggerExpanded(this.isActive);\n\n    // add click event listener\n    if (!this.noTriggerClickHandler) {\n      this.triggerEl.addEventListener('click', () => this.toggle());\n    }\n\n    this.clickOutsideCleanUp = onClickOutside(this.el, (e) => {\n      if (!this.triggerEl.contains(e.target as Node) && this.isActive) {\n        this.close();\n      }\n    });\n    /**\n     * Calculate position of dropdown\n     */\n    const middleware = [offset(4), flip()];\n    this.cleanupAutoUpdate = autoUpdate(\n      this.triggerEl,\n      this.el,\n      debounce(() => {\n        computePosition(this.triggerEl, this.el, {\n          strategy: 'fixed',\n          placement: 'bottom-start',\n          middleware,\n        }).then(({ x, y, middlewareData }) => {\n          Object.assign(this.el.style, {\n            left: `${x}px`,\n            top: `${y}px`,\n          });\n          if (middlewareData.flip?.overflows?.length > 0) {\n            this.el.classList.add('flip');\n          } else {\n            this.el.classList.remove('flip');\n          }\n        });\n      }, 50),\n    );\n  }\n\n  setTriggerExpanded(expanded: boolean) {\n    this.triggerEl.setAttribute('aria-expanded', String(expanded));\n  }\n\n  @Watch('isActive')\n  handleActiveChange(isActive) {\n    this.setTriggerExpanded(isActive);\n    if (isActive) {\n      this.el.style.display = 'block';\n      // focusFirstWithin(this.el);\n    } else {\n      this.el.addEventListener(\n        'transitionend',\n        () => {\n          this.el.style.display = 'none';\n        },\n        { once: true },\n      );\n      this.triggerEl.focus();\n    }\n  }\n\n  render() {\n    let { isActive, width, fullWidth } = this;\n    return (\n      <Host\n        class={{ 'is-active': isActive, 'full-width': fullWidth }}\n        aria-hidden={isActive ? 'false' : 'true'}\n        style={{ '--dropdown-width': width }}>\n        <div class=\"dropdown-content\">\n          <slot></slot>\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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"}