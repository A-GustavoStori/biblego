{"version":3,"file":"go-dropdown.js","sourceRoot":"","sources":["../../../src/components/go-dropdown/go-dropdown.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, Element, Prop, Method, Watch, Event, EventEmitter } from '@stencil/core';\nimport { uniqueId, debounce } from 'lodash-es';\nimport { computePosition, offset, flip, autoUpdate } from '@floating-ui/dom';\nimport { onClickOutside } from '../../utils';\n\n@Component({\n  tag: 'go-dropdown',\n  styleUrl: 'go-dropdown.scss',\n  shadow: false,\n})\nexport class GoDropdown {\n  @Element() el: HTMLElement;\n  /**\n   * Query selector string for the trigger element.\n   */\n  @Prop() triggerSelector: string;\n\n  /**\n   * keep track of active state\n   */\n  @Prop({ reflect: true, mutable: true }) isActive: boolean = false;\n\n  /**\n   * Width of the dropdown, any CSS width values can be used.\n   */\n  @Prop() width? = 'auto';\n\n  /**\n   * If set, trigger click event will need to be handled manually.\n   */\n  @Prop() noTriggerClickHandler = false;\n\n  /**\n   * If set, dropdown will take full width of its parent.\n   */\n  @Prop() fullWidth? = false;\n\n  /**\n   * if set, dropdown cannot be opened\n   */\n  @Prop() disabled? = false;\n\n  /**\n   * Emitted when dropdown is opened\n   */\n  @Event() opened: EventEmitter<void>;\n\n  // keep track of where the focus was before the dropdown opens\n  originEl: HTMLElement;\n\n  /**\n   * opens dropdown\n   */\n  @Method()\n  async open() {\n    if (this.disabled) {\n      return;\n    }\n    this.originEl = document.activeElement as HTMLElement;\n    this.isActive = true;\n    this.opened.emit();\n  }\n  /**\n   * Emitted when dropdown is opened\n   */\n  @Event() closed: EventEmitter<void>;\n\n  /**\n   * closes dropdown\n   */\n  @Method()\n  async close(focusBackToTrigger = false) {\n    this.isActive = false;\n    this.closed.emit();\n    if (this.originEl && focusBackToTrigger) {\n      this.originEl.focus();\n    }\n  }\n\n  /**\n   * toggles dropdown\n   */\n  @Method()\n  async toggle() {\n    if (this.isActive) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  private triggerEl: HTMLElement;\n\n  // reference to clean up function to autoupdate\n  // see https://floating-ui.com/docs/autoupdate\n  private cleanupAutoUpdate: () => void;\n\n  componentWillLoad() {\n    // if id attribute is not provided, generate a unique id for the dropdown\n    if (!this.el.id) {\n      this.el.id = uniqueId('go-dropdown-');\n    }\n    this.triggerEl = document.querySelector(`${this.triggerSelector}`) as HTMLElement;\n  }\n\n  private escapeHandler;\n  private focusOutHandler;\n  private clickOutsideCleanUp;\n\n  async componentDidLoad() {\n    if (!this.triggerEl) {\n      return;\n    }\n    await this.init();\n\n    // press esc to close dropdown\n    this.escapeHandler = (e) => {\n      if (e.code === 'Escape') {\n        this.close();\n      }\n    };\n    this.focusOutHandler = (e: FocusEvent) => {\n      if (this.triggerEl.contains(e.relatedTarget as Node)) {\n        return;\n      }\n      if (e.relatedTarget && !this.el.contains(e.relatedTarget as Node)) {\n        this.close();\n      }\n    };\n    document.addEventListener('keydown', this.escapeHandler);\n    // focus outside to close dropdown\n    this.el.addEventListener('focusout', this.focusOutHandler);\n  }\n\n  disconnectedCallback() {\n    if (this.escapeHandler) {\n      document.removeEventListener('keydown', this.escapeHandler);\n    }\n    if (this.focusOutHandler) {\n      this.el.removeEventListener('focusout', this.focusOutHandler);\n    }\n    if (this.clickOutsideCleanUp) {\n      this.clickOutsideCleanUp();\n    }\n    if (this.cleanupAutoUpdate) {\n      this.cleanupAutoUpdate();\n    }\n  }\n\n  @Method()\n  async init() {\n    this.triggerEl.setAttribute('aria-haspopup', 'true');\n    this.setTriggerExpanded(this.isActive);\n\n    // add click event listener\n    if (!this.noTriggerClickHandler) {\n      this.triggerEl.addEventListener('click', () => this.toggle());\n    }\n\n    this.clickOutsideCleanUp = onClickOutside(this.el, (e) => {\n      if (!this.triggerEl.contains(e.target as Node) && this.isActive) {\n        this.close();\n      }\n    });\n    /**\n     * Calculate position of dropdown\n     */\n    const middleware = [offset(4), flip()];\n    this.cleanupAutoUpdate = autoUpdate(\n      this.triggerEl,\n      this.el,\n      debounce(() => {\n        computePosition(this.triggerEl, this.el, {\n          strategy: 'fixed',\n          placement: 'bottom-start',\n          middleware,\n        }).then(({ x, y, middlewareData }) => {\n          Object.assign(this.el.style, {\n            left: `${x}px`,\n            top: `${y}px`,\n          });\n          if (middlewareData.flip?.overflows?.length > 0) {\n            this.el.classList.add('flip');\n          } else {\n            this.el.classList.remove('flip');\n          }\n        });\n      }, 50),\n    );\n  }\n\n  setTriggerExpanded(expanded: boolean) {\n    this.triggerEl.setAttribute('aria-expanded', String(expanded));\n  }\n\n  @Watch('isActive')\n  handleActiveChange(isActive) {\n    this.setTriggerExpanded(isActive);\n    if (isActive) {\n      this.el.style.display = 'block';\n      // focusFirstWithin(this.el);\n    } else {\n      this.el.addEventListener(\n        'transitionend',\n        () => {\n          this.el.style.display = 'none';\n        },\n        { once: true },\n      );\n      this.triggerEl.focus();\n    }\n  }\n\n  render() {\n    let { isActive, width, fullWidth } = this;\n    return (\n      <Host\n        class={{ 'is-active': isActive, 'full-width': fullWidth }}\n        aria-hidden={isActive ? 'false' : 'true'}\n        style={{ '--dropdown-width': width }}>\n        <div class=\"dropdown-content\">\n          <slot></slot>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}